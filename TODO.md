Add flowlet switching
Possibly separate Run() into Setup(), Run() and Finalize()
